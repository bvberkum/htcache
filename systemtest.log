
=============================================================================
 SYSTEM-TEST 1: DOWNLOADING NEW FILE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest1.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 13673
[ TEST ] Finished download out1 at 478105 bytes
[ TEST ] Finished download out2 at 478105 bytes
[ TEST ] Interrupted server at PID 13673
 * file cached and finalized                                           PASSED 
 * record exists                                                       PASSED 
 * separate download and served file are equal                         PASSED 
 * cached and served file are equal                                    PASSED 
 * normal and served entity headers are equal                          PASSED 
 * served HTTP v1.1 OK                                                 PASSED 
 * served via proxy                                                    PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 2: LEAVING PARTIAL FILE IN CACHE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest2.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 13808
[ TEST ] Finished download normal at 478105 bytes
[ TEST ] Interrupted server at PID 13808
 * aborted client read                                                 PASSED 
 * record exists                                                       PASSED 
 * file cached, not finalized                                          PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 3: SERVING FILE FROM CACHE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest3.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 13882
[ TEST ] Finished download out at 478105 bytes
[ TEST ] Finished download out1 at 478105 bytes
[ TEST ] Finished download out2 at 478105 bytes
[ TEST ] Interrupted server at PID 13882
 * first file cached and finalized                                     PASSED 
 * record exists                                                       PASSED 
 * cached and normal file are equal                                    PASSED 
 * first file served via proxy                                         PASSED 
 * second file served via proxy                                        PASSED 
 * first file served HTTP v1.1 OK                                      PASSED 
 * second file served HTTP v1.1 OK                                     PASSED 
 * first file stored in cache                                          PASSED 
 * second file served from cache                                       PASSED 
 * cached and first served file are equal                              PASSED 
 * cached and second served file are equal                             PASSED 
 * normal and first served headers are equal                           PASSED 
 * normal and second served headers are equal                          PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 4: RESUMING PARTIAL FILE BY CLIENT
 ---------------------------------------------------------------------------
[ TEST ] Finished download out at 478105 bytes
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest4.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 14131
[ TEST ] Resuming unfinished download at 24576 bytes
[ TEST ] Finished download out2 at 478105 bytes
[ TEST ] Interrupted server at PID 14131
 * received complete file                                              PASSED 
 * served partial file                                                 PASSED 
 * cached and served file are equal                                    PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 5: REDOWNLOADING CHANGED FILE
 ---------------------------------------------------------------------------

=============================================================================
 SYSTEM-TEST 6: RESUMING PARTIAL UNCHANGED FILE IN CACHE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest6.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 14220

./system-test: line 98: 14222 Terminated              http_proxy=$HOSTNAME:$PORT download http://$URL_HTTP out1
[ TEST ] Finished download out2 at 478105 bytes
[ TEST ] Interrupted server at PID 14220
 * cached and served file are equal                                    PASSED 
 * htcache asks for missing part                                       PASSED 
 * server sends part                                                   PASSED 
 * htcache resumes content                                             PASSED 
 * finalized file                                                      PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 7: RESUMING PARTIAL CHANGED FILE IN CACHE
 ---------------------------------------------------------------------------

=============================================================================
 SYSTEM-TEST 8: JOINING THREE+TWO DOWNLOADS
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest8.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 14312
[ TEST ] Finished download out at 478105 bytes
[ TEST ] Finished download out4 at 478105 bytes
[ TEST ] Finished download out5 at 659 bytes
[ TEST ] Interrupted server at PID 14312
Trying partial for first file /tmp/htcache-systemtest8.cache/www.w3.org/Protocols/HTTP/1.1/rfc2616bis/draft-lafon-rfc2616bis-03.incomplete.txt
 * cache and normal download are equal                                 ERROR not equal
 * downloads are joined                                                ERROR 
Trying partial for first file /tmp/htcache-systemtest8.cache/www.w3.org/Protocols/HTTP/1.1/rfc2616bis/draft-lafon-rfc2616bis-03.incomplete.txt
 * cache and first download are equal                                  ERROR not equal
Trying partial for first file /tmp/htcache-systemtest8.cache/www.w3.org/Protocols/HTTP/1.1/rfc2616bis/draft-lafon-rfc2616bis-03.incomplete.txt
 * cache and second concurrent download are equal                      ERROR not equal
Trying partial for first file /tmp/htcache-systemtest8.cache/www.w3.org/Protocols/HTTP/1.1/rfc2616bis/draft-lafon-rfc2616bis-03.incomplete.txt
 * cache and third concurrent download are equal                       ERROR not equal
Trying partial for first file /tmp/htcache-systemtest8.cache/www.w3.org/Protocols/HTTP/1.1/rfc2616bis/draft-lafon-rfc2616bis-03.incomplete.txt
 * cache and subsequent download are equal                             ERROR not equal
Trying partial for first file /tmp/htcache-systemtest8.cache/www.w3.org/Protocols/HTTP/1.1/rfc2616bis/draft-lafon-rfc2616bis-03.incomplete.txt
 * cache and second subsequent download are equal                      ERROR not equal
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 9: DOWNLOADING NEW FILE, CHUNKED TRANSFER
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest9.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 14644
[ TEST ] Finished download out1 at 72200 bytes
Giving ChunkedScript server a rest for 5 seconds..
[ TEST ] Finished download out2 at 72200 bytes
[ TEST ] Finished download out3 at 72200 bytes
[ TEST ] Finished download out6 at 5 bytes
[ TEST ] Finished download out7 at 10615 bytes
[ TEST ] Interrupted server at PID 14644
 * normal and proxy response entity 1 are equal                        PASSED 
 * normal and proxy response entity 2 are equal                        PASSED 
 * server sends chunked data                                           PASSED 
 * processing chunked data                                             ERROR 
 * cached and served file are equal                                    PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 10: FILTERED PROXY RESPONSE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest10.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 14915
[ TEST ] Finished download out at 2005 bytes
[ TEST ] Interrupted server at PID 14915
 * blocked request to server                                           PASSED 
 * server sent 403                                                     PASSED 
 * served HTML                                                         PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 11: BLIND PROXY RESPONSE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest11.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 14954
[ TEST ] Finished download out at 478105 bytes
[ TEST ] Interrupted server at PID 14954
 * blocked request to server                                           PASSED 
 * served HTTP v1.* OK                                                 PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 12: DOWNLOADING NEW FILE, FTP TRANSFER
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest12.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 15022
[ TEST ] Finished download out1 at 312708 bytes
curl: (52) Empty reply from server
stat: cannot stat ‘/tmp/htcache-systemtest12.out2’: No such file or directory
[ TEST ] Finished download out2 at  bytes
mv: cannot stat ‘/tmp/htcache-systemtest12.out2.entity.headers’: No such file or directory
sort: cannot read: /tmp/htcache-systemtest12.out2.entity.headers.tmp: No such file or directory
rm: cannot remove ‘/tmp/htcache-systemtest12.out2.entity.headers.tmp’: No such file or directory
[ TEST ] Interrupted server at PID 15022
 * separate download and served file are equal                         ERROR 2nd missing:
-> out2
 * cached and served file are equal                                    ERROR 1st missing:
-> cache/ftp.debian.org:21/debian/doc/FAQ/debian-faq.en.pdf.gz
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 13: SERVING FILE FROM CACHE, FTP TRANSFER
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest13.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 15094
curl: (52) Empty reply from server
stat: cannot stat ‘/tmp/htcache-systemtest13.out1’: No such file or directory
[ TEST ] Finished download out1 at  bytes
mv: cannot stat ‘/tmp/htcache-systemtest13.out1.entity.headers’: No such file or directory
sort: cannot read: /tmp/htcache-systemtest13.out1.entity.headers.tmp: No such file or directory
rm: cannot remove ‘/tmp/htcache-systemtest13.out1.entity.headers.tmp’: No such file or directory
curl: (52) Empty reply from server
stat: cannot stat ‘/tmp/htcache-systemtest13.out2’: No such file or directory
[ TEST ] Finished download out2 at  bytes
mv: cannot stat ‘/tmp/htcache-systemtest13.out2.entity.headers’: No such file or directory
sort: cannot read: /tmp/htcache-systemtest13.out2.entity.headers.tmp: No such file or directory
rm: cannot remove ‘/tmp/htcache-systemtest13.out2.entity.headers.tmp’: No such file or directory
[ TEST ] Interrupted server at PID 15094
 * first file cached and finalized                                     ERROR 
 * second file served from cache                                       ERROR 
 * cached and first served file are equal                              ERROR 1st missing:
-> cache/ftp.debian.org:21/debian/doc/FAQ/debian-faq.en.pdf.gz
 * cached and second served file are equal                             ERROR 1st missing:
-> cache/ftp.debian.org:21/debian/doc/FAQ/debian-faq.en.pdf.gz
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 14: RESUMING PARTIAL UNCHANGED FILE IN CACHE, FTP TRANSFER
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest14.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 15131
curl: (52) Empty reply from server
curl: (52) Empty reply from server
stat: cannot stat ‘/tmp/htcache-systemtest14.out2’: No such file or directory
[ TEST ] Finished download out2 at  bytes
stat: cannot stat ‘/tmp/htcache-systemtest14.out1’: No such file or directory
[ TEST ] Finished download out1 at  bytes
mv: mv: cannot stat ‘/tmp/htcache-systemtest14.out1.entity.headers’: No such file or directory
cannot stat ‘/tmp/htcache-systemtest14.out2.entity.headers’: No such file or directory
sort: cannot read: /tmp/htcache-systemtest14.out1.entity.headers.tmp: No such file or directory
sort: cannot read: /tmp/htcache-systemtest14.out2.entity.headers.tmp: No such file or directory
rm: cannot remove ‘/tmp/htcache-systemtest14.out1.entity.headers.tmp’: No such file or directory
rm: cannot remove ‘/tmp/htcache-systemtest14.out2.entity.headers.tmp’: No such file or directory
[ TEST ] Interrupted server at PID 15131
 * htcache resumes file                                                ERROR 
 * cached and served file are equal                                    ERROR 1st missing:
-> cache/ftp.debian.org:21/debian/doc/FAQ/debian-faq.en.pdf.gz
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 16: STATIC MODE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest16.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 15178
[ TEST ] Finished download normal at 478105 bytes
[ TEST ] Interrupted server at PID 15178
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest16.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 15236
[ TEST ] Finished download static at 478105 bytes
[ TEST ] Interrupted server at PID 15236
 * serving directly from cache without consulting server               PASSED 
 * cached and served file are equal                                    PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 17: OFF-LINE MODE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest17.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 15294
[ TEST ] Finished download out at 350 bytes
[ TEST ] Interrupted server at PID 15294
 * refusing to connect to server                                       PASSED 

=============================================================================
 SYSTEM-TEST 18: MISC
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest18.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 15333
[ TEST ] Finished download out at 1251 bytes
[ TEST ] Finished download out1 at 1251 bytes
[ TEST ] Interrupted server at PID 15333
 * cached and normal file are equal                                    PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 19: HTTP POST
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest19.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 15467
[ TEST ] Finished download out2 at 1251 bytes
[ TEST ] Interrupted server at PID 15467
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 20: DIRECT REQUEST
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest20.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 15534
[ TEST ] Finished download info at 795 bytes
[ TEST ] Finished download downloads at 47 bytes
[ TEST ] Finished download list at 68 bytes
[ TEST ] Finished download echo at 315 bytes
[ TEST ] Finished download page-info at 676 bytes
[ TEST ] Finished download dhtml.css at 1366 bytes
[ TEST ] Finished download dhtml.js at 4576 bytes
[ TEST ] Interrupted server at PID 15534
 * dhtml.css                                                           PASSED 
 * dhtml.js                                                            PASSED 
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 21: SERVICE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest21.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 15708
[ TEST ] Finished download out at 478105 bytes
[ TEST ] Interrupted server at PID 15708
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 22: DNS exception
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest22.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 15794
[ TEST ] Finished download out2 at 391 bytes
[ TEST ] Interrupted server at PID 15794
 * Exception response                                                  PASSED 
 * DNS exception                                                       PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 23: HTTP Moved Permanently
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest23.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 15835
stat: cannot stat ‘/tmp/htcache-systemtest23.out3’: No such file or directory
[ TEST ] Finished download out3 at  bytes
[ TEST ] Interrupted server at PID 15835
 * Moved Permanently                                                   PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 24: HTTP Forbidden
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest24.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 15875
[ TEST ] Finished download out4 at 211 bytes
[ TEST ] Interrupted server at PID 15875
 * Forbidden                                                           PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 25: HTTP Not Found
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest25.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 15939
[ TEST ] Finished download out5 at 219 bytes
[ TEST ] Interrupted server at PID 15939
 * Not Found                                                           PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 26: COVERAGE REPORT
 ---------------------------------------------------------------------------
Generating coverage report
Name          Stmts   Miss Branch BrMiss  Cover
-----------------------------------------------
Cache           142     28     34     12    77%
Command         124     23     34     13    77%
HTTP             22      2      8      2    87%
HTTP_Status      14      0      0      0   100%
Params           41      0      0      0   100%
Protocol        296     42     71     23    82%
Request         171     20     48     12    85%
Resource        541    190    190    115    58%
Response        322     81     97     43    70%
Rules           131     54     56     26    57%
Runtime          36      0      0      0   100%
caches          127     75     52     38    37%
error             2      0      0      0   100%
fiber           215     67     48     17    68%
log              63     18     18     10    65%
util             67     20     20     11    64%
-----------------------------------------------
TOTAL          2314    620    676    322    68%
