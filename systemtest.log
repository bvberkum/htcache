
=============================================================================
 SYSTEM-TEST 1: DOWNLOADING NEW FILE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest1.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 17245
[ TEST ] Finished download out1 at 478105 bytes
[ TEST ] Finished download out2 at 478105 bytes
[ TEST ] Interrupted server at PID 17245
 * file cached and finalized                                           PASSED 
 * record exists                                                       PASSED 
 * separate download and served file are equal                         PASSED 
 * cached and served file are equal                                    PASSED 
 * normal and served entity headers are equal                          PASSED 
 * served HTTP v1.1 OK                                                 PASSED 
 * served via proxy                                                    PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 2: LEAVING PARTIAL FILE IN CACHE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest2.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 17380
[ TEST ] Finished download normal at 478105 bytes
[ TEST ] Interrupted server at PID 17380
 * aborted client read                                                 PASSED 
 * record exists                                                       PASSED 
 * file cached, not finalized                                          PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 3: SERVING FILE FROM CACHE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest3.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 17454
[ TEST ] Finished download out at 478105 bytes
[ TEST ] Finished download out1 at 478105 bytes
[ TEST ] Finished download out2 at 478105 bytes
[ TEST ] Interrupted server at PID 17454
 * first file cached and finalized                                     PASSED 
 * record exists                                                       PASSED 
 * cached and normal file are equal                                    PASSED 
 * first file served via proxy                                         PASSED 
 * second file served via proxy                                        PASSED 
 * first file served HTTP v1.1 OK                                      PASSED 
 * second file served HTTP v1.1 OK                                     PASSED 
 * first file stored in cache                                          PASSED 
 * second file served from cache                                       PASSED 
 * cached and first served file are equal                              PASSED 
 * cached and second served file are equal                             PASSED 
 * normal and first served headers are equal                           PASSED 
 * normal and second served headers are equal                          PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 4: RESUMING PARTIAL FILE BY CLIENT
 ---------------------------------------------------------------------------
[ TEST ] Finished download out at 478105 bytes
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest4.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 17702
[ TEST ] Resuming unfinished download at 24576 bytes
[ TEST ] Finished download out2 at 478105 bytes
[ TEST ] Interrupted server at PID 17702
 * received complete file                                              PASSED 
 * served partial file                                                 PASSED 
 * cached and served file are equal                                    PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 5: REDOWNLOADING CHANGED FILE
 ---------------------------------------------------------------------------

=============================================================================
 SYSTEM-TEST 6: RESUMING PARTIAL UNCHANGED FILE IN CACHE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest6.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 17791

./system-test: line 98: 17793 Terminated              http_proxy=$HOSTNAME:$PORT download http://$URL_HTTP out1
[ TEST ] Finished download out2 at 478105 bytes
[ TEST ] Interrupted server at PID 17791
 * cached and served file are equal                                    PASSED 
 * htcache asks for missing part                                       PASSED 
 * server sends part                                                   PASSED 
 * htcache resumes content                                             PASSED 
 * finalized file                                                      PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 7: RESUMING PARTIAL CHANGED FILE IN CACHE
 ---------------------------------------------------------------------------

=============================================================================
 SYSTEM-TEST 8: JOINING THREE+TWO DOWNLOADS
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest8.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 17882
[ TEST ] Finished download out at 478105 bytes
[ TEST ] Finished download out4 at 478105 bytes
[ TEST ] Finished download out5 at 916 bytes
[ TEST ] Interrupted server at PID 17882
 * cache and normal download are equal                                 ERROR 1st missing:
-> cache/www.w3.org/Protocols/HTTP/1.1/rfc2616bis/draft-lafon-rfc2616bis-03.txt
 * downloads are joined                                                ERROR 
 * cache and first download are equal                                  ERROR 1st missing:
-> cache/www.w3.org/Protocols/HTTP/1.1/rfc2616bis/draft-lafon-rfc2616bis-03.txt
 * cache and second concurrent download are equal                      ERROR 1st missing:
-> cache/www.w3.org/Protocols/HTTP/1.1/rfc2616bis/draft-lafon-rfc2616bis-03.txt
 * cache and third concurrent download are equal                       ERROR 1st missing:
-> cache/www.w3.org/Protocols/HTTP/1.1/rfc2616bis/draft-lafon-rfc2616bis-03.txt
 * cache and subsequent download are equal                             ERROR 1st missing:
-> cache/www.w3.org/Protocols/HTTP/1.1/rfc2616bis/draft-lafon-rfc2616bis-03.txt
 * cache and second subsequent download are equal                      ERROR 1st missing:
-> cache/www.w3.org/Protocols/HTTP/1.1/rfc2616bis/draft-lafon-rfc2616bis-03.txt
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 9: DOWNLOADING NEW FILE, CHUNKED TRANSFER
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest9.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 18178
[ TEST ] Finished download out1 at 72200 bytes
Giving ChunkedScript server a rest for 5 seconds..
[ TEST ] Finished download out2 at 72200 bytes
[ TEST ] Finished download out3 at 72200 bytes
[ TEST ] Finished download out6 at 5 bytes
[ TEST ] Finished download out7 at 10615 bytes
[ TEST ] Interrupted server at PID 18178
 * normal and proxy response entity 1 are equal                        PASSED 
 * normal and proxy response entity 2 are equal                        PASSED 
 * server sends chunked data                                           PASSED 
 * processing chunked data                                             PASSED 
 * cached and served file are equal                                    PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 10: FILTERED PROXY RESPONSE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest10.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 18450
[ TEST ] Finished download out at 727 bytes
[ TEST ] Interrupted server at PID 18450
 * blocked request to server                                           PASSED 
 * server sent 403                                                     ERROR 
 * served HTML                                                         ERROR 
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 11: BLIND PROXY RESPONSE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest11.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 18492
[ TEST ] Finished download out at 478105 bytes
[ TEST ] Interrupted server at PID 18492
 * blocked request to server                                           PASSED 
 * served HTTP v1.* OK                                                 PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 12: DOWNLOADING NEW FILE, FTP TRANSFER
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest12.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 18560
[ TEST ] Finished download out1 at 312708 bytes
curl: (52) Empty reply from server
stat: cannot stat ‘/tmp/htcache-systemtest12.out2’: No such file or directory
[ TEST ] Finished download out2 at  bytes
mv: cannot stat ‘/tmp/htcache-systemtest12.out2.entity.headers’: No such file or directory
sort: cannot read: /tmp/htcache-systemtest12.out2.entity.headers.tmp: No such file or directory
rm: cannot remove ‘/tmp/htcache-systemtest12.out2.entity.headers.tmp’: No such file or directory
[ TEST ] Interrupted server at PID 18560
 * separate download and served file are equal                         ERROR 2nd missing:
-> out2
 * cached and served file are equal                                    ERROR 1st missing:
-> cache/ftp.debian.org:21/debian/doc/FAQ/debian-faq.en.pdf.gz
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 13: SERVING FILE FROM CACHE, FTP TRANSFER
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest13.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 18632
curl: (52) Empty reply from server
stat: cannot stat ‘/tmp/htcache-systemtest13.out1’: No such file or directory
[ TEST ] Finished download out1 at  bytes
mv: cannot stat ‘/tmp/htcache-systemtest13.out1.entity.headers’: No such file or directory
sort: cannot read: /tmp/htcache-systemtest13.out1.entity.headers.tmp: No such file or directory
rm: cannot remove ‘/tmp/htcache-systemtest13.out1.entity.headers.tmp’: No such file or directory
curl: (52) Empty reply from server
stat: cannot stat ‘/tmp/htcache-systemtest13.out2’: No such file or directory
[ TEST ] Finished download out2 at  bytes
mv: cannot stat ‘/tmp/htcache-systemtest13.out2.entity.headers’: No such file or directory
sort: cannot read: /tmp/htcache-systemtest13.out2.entity.headers.tmp: No such file or directory
rm: cannot remove ‘/tmp/htcache-systemtest13.out2.entity.headers.tmp’: No such file or directory
[ TEST ] Interrupted server at PID 18632
 * first file cached and finalized                                     ERROR 
 * second file served from cache                                       ERROR 
 * cached and first served file are equal                              ERROR 1st missing:
-> cache/ftp.debian.org:21/debian/doc/FAQ/debian-faq.en.pdf.gz
 * cached and second served file are equal                             ERROR 1st missing:
-> cache/ftp.debian.org:21/debian/doc/FAQ/debian-faq.en.pdf.gz
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 14: RESUMING PARTIAL UNCHANGED FILE IN CACHE, FTP TRANSFER
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest14.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 18669
curl: (52) Empty reply from server
curl: (52) Empty reply from server
stat: cannot stat ‘/tmp/htcache-systemtest14.out2’: No such file or directory
[ TEST ] Finished download out2 at  bytes
stat: cannot stat ‘/tmp/htcache-systemtest14.out1’: No such file or directory
[ TEST ] Finished download out1 at  bytes
mv: cannot stat ‘/tmp/htcache-systemtest14.out2.entity.headers’: No such file or directory
mv: cannot stat ‘/tmp/htcache-systemtest14.out1.entity.headers’: No such file or directory
sort: cannot read: /tmp/htcache-systemtest14.out2.entity.headers.tmp: No such file or directory
sort: cannot read: /tmp/htcache-systemtest14.out1.entity.headers.tmp: No such file or directory
rm: rm: cannot remove ‘/tmp/htcache-systemtest14.out1.entity.headers.tmp’: No such file or directory
cannot remove ‘/tmp/htcache-systemtest14.out2.entity.headers.tmp’: No such file or directory
[ TEST ] Interrupted server at PID 18669
 * htcache resumes file                                                ERROR 
 * cached and served file are equal                                    ERROR 1st missing:
-> cache/ftp.debian.org:21/debian/doc/FAQ/debian-faq.en.pdf.gz
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 16: STATIC MODE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest16.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 18716
[ TEST ] Finished download out1 at 709 bytes
[ TEST ] Finished download out2 at 709 bytes
[ TEST ] Interrupted server at PID 18716
 * serving directly from cache without consulting server               ERROR 
 * cached and served file are equal                                    ERROR 1st missing:
-> cache/www.w3.org/Protocols/HTTP/1.1/rfc2616bis/draft-lafon-rfc2616bis-03.txt
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 17: OFF-LINE MODE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest17.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 18777
[ TEST ] Finished download out at 789 bytes
[ TEST ] Interrupted server at PID 18777
 * refusing to connect to server                                       PASSED 
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 18: MISC
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest18.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 18817
[ TEST ] Finished download out at 1251 bytes
[ TEST ] Finished download out1 at 1251 bytes
[ TEST ] Interrupted server at PID 18817
 * cached and normal file are equal                                    PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 19: HTTP POST
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest19.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 18943
[ TEST ] Finished download out2 at 1251 bytes
[ TEST ] Interrupted server at PID 18943
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 20: DIRECT REQUEST
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest20.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 19010
[ TEST ] Finished download info at 795 bytes
[ TEST ] Finished download downloads at 47 bytes
[ TEST ] Finished download list at 68 bytes
[ TEST ] Finished download echo at 315 bytes
[ TEST ] Finished download out at 478105 bytes
[ TEST ] Finished download page-info at 1068 bytes
[ TEST ] Finished download dhtml.css at 1366 bytes
[ TEST ] Finished download dhtml.js at 4576 bytes
[ TEST ] Interrupted server at PID 19010
 * dhtml.css                                                           PASSED 
 * dhtml.js                                                            PASSED 
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 21: SERVICE
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest21.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 19235
[ TEST ] Finished download out at 478105 bytes
[ TEST ] Interrupted server at PID 19235
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 22: DNS exception
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest22.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 19321
[ TEST ] Finished download out2 at 775 bytes
[ TEST ] Interrupted server at PID 19321
 * DNS exception                                                       PASSED 
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 23: HTTP Moved Permanently
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest23.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 19361
stat: cannot stat ‘/tmp/htcache-systemtest23.out3’: No such file or directory
[ TEST ] Finished download out3 at  bytes
[ TEST ] Interrupted server at PID 19361
 * Moved Permanently                                                   PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 24: HTTP Forbidden
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest24.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 19401
[ TEST ] Finished download out4 at 586 bytes
[ TEST ] Interrupted server at PID 19401
 * Forbidden                                                           PASSED 
 * log is clean                                                        ERROR 

=============================================================================
 SYSTEM-TEST 25: HTTP Not Found
 ---------------------------------------------------------------------------
[ TEST ] Starting server at port 8888
[ FORK ] preparing daemon process with log /tmp/htcache-systemtest25.log 
[ FORK ] OK, daemon running.
[ TEST ] Started server, running at PID 19441
[ TEST ] Finished download out5 at 219 bytes
[ TEST ] Interrupted server at PID 19441
 * Not Found                                                           PASSED 
 * log is clean                                                        PASSED 

=============================================================================
 SYSTEM-TEST 26: COVERAGE REPORT
 ---------------------------------------------------------------------------
Generating coverage report
Name       Stmts   Miss Branch BrMiss  Cover
--------------------------------------------
Cache        142     30     34     11    77%
Command      124     23     34     13    77%
HTTP          26      0      4      0   100%
Params        41      0      0      0   100%
Protocol     285     31     69     22    85%
Request      171     18     48     11    87%
Resource     530    165    186    114    61%
Response     303     79     97     39    71%
Rules        131     54     56     26    57%
Runtime       36      0      0      0   100%
caches       127     75     52     38    37%
error          2      0      0      0   100%
fiber        215     38     48     12    81%
log           63     18     18     10    65%
util          67     20     20     11    64%
--------------------------------------------
TOTAL       2263    551    666    307    71%
